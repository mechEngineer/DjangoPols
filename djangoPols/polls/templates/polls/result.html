{% extends 'polls/base.html' %}

{% block content %}
<div class="title">
    <h1>{{question.question_text}}</h1> <hr>
</div>

    {% if error_message %} <p><strong>{{ error_message }}</stromg</p> {% endif %}
    {% for choice in question.choice_set.all %}
    <div class="results">
        <div class="result-item">
            <span>
            {{choice.choice_text}} -- {{choice.votes}} vote{{choice.votes|pluralize}}
            </span>
        </div>
    </div>
    {% endfor %}
    
    </ul>

    <a href=" {% url 'polls:detail' question.id %} "> Vote again</a>

<h2>Dijagram glasova</h2>
<div class="chart-area">
    <div class="chart-container" >
        <canvas id="chart" width="60%"> </canvas>
    </div>
</div>
{% endblock content %}


{% block scripts %}
<script>
var a = [
{% for choice in question.choice_set.all %}
    {{choice.votes}},
{% endfor %}
];
var sum  = a.reduce((x, y) => x + y);
var x = document.getElementsByClassName("result-item");
console.log(a);
console.log(sum);
console.log(x);

var i;
for (i = 0; i < a.length; i++) {
  a[i] = a[i] / sum * 100;
}
console.log(a);

var i;
for (i = 0; i < a.length; i++) {
  x[i].style.width=`${a[i]}%`;
}



var ctx = document.getElementById('chart').getContext('2d');
var chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'bar',

    // The data for our dataset
    data: {
        labels: [{% for choice in question.choice_set.all %} 
        '{{choice.choice_text}}',{% endfor %} ],
        datasets: [{
            label: '# od Votes',
            backgroundColor: ['rgb(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)'],
            borderColor: ['rgb(255, 99, 132)', 
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)'],
            borderWidth: 2,
            hoverBorderWidth: 5,
            data: [{% for choice in question.choice_set.all %} 
        '{{choice.votes}}', {% endfor %} ]
        }]
    },

    // Configuration options go here
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        },
        layout: {
            padding: {
                left: 50,
                right: 50,
                top: 0,
                bottom: 0
            }
    }}
});
</script>
{% endblock scripts %}





